/****************************************
文件名称： 四驱智能小车V4.0程序
时间：2015年8月11日
版本：V4.0
说明：
修改记录：
****************************************/  
#ifndef _STC12C5A60S2_PWM_H
#define _STC12C5A60S2_PWM_H

#include <STC12C5A60S2.H>

/***************************
STC12C5A16S2:
PWM0输出为P1.3脚
PWM1输出为P1.4脚
晶振：22.1184Mhz
本程序不占用定时器资源。
/**************************/

/***PWM相关特殊功能寄存器***/
              //-----------------------------
              // 7  6 5 4 | 3 2  1    0
//sfr CCON=0xD8;//CF CR - - | - - CCF1 CCF0
              //-----------------------------
              //CF:PCA计数阵列溢出标志.计数值翻转时由硬件置位。
              //CR:PCA计数阵列运行控制位。
              //CCF1:PCA模块1中断标志。当出现匹配或者捕获时由硬件置位。
              //CCF0:PCA模块0中断标志。当出现匹配或者捕获时由硬件置位。
              //*******************************************************

              // 7   6 5 4   3    2     1   0
// sfr CMOD=0xD9;//CIDL - - -  CPS2 CPS1 CPS0 ECF
              //--------------------------------
              //CIDL:计数阵列空闲控制，0时，空闲模式下PCA计数器继续工作；1时空闲模式PCA停止工作。
              //----------------------------------------------
              //CPS2 CPS1 CPS0: PCA计数脉冲选择
              //000:系统时钟，FOSC/12
              //001:系统时钟，FOSC/2
              //010:定时器0的溢出，可实现可调频率PWM输出
              //011:ECI/P3.4脚的外部时钟输入(最大速率FOSC/2)
              //100:系统时钟,FOSC
              //101:系统时钟/4,FOSC/4
              //110:系统时钟/6,FOSC/6
              //111:系统时钟/8,FOSC/8
              //-----------------------------------------------
              //ECF:PCA计数溢出中断使能:1时，使能寄存器CCON CF位的中断。0时禁止该功能。  
							
// sfr CL=0xE9;//CL和CH为正在自由递增计数的16位PCA定时器的值。
// sfr CH=0xF9;
/***PWM0相关特殊功能寄存器***/
// sfr CCAP0L=0xEA;//PCA模块0的捕捉/比较寄存器低8位
// sfr CCAP0H=0xFA;//PCA模块0的捕捉/比较寄存器高8位

// sfr CCAPM0=0xDA;//PCA模块0的工作模式寄存器
                //---------------------------------------
                //7   6    5     4     3    2    1    0
                //- ECMn CAPPn CAPNn MATn T0Gn PWMn ECCFn
                //----------------------------------------
                //ECOMn:使能比较器，1时使能比较器功能
                //CAPPn：正捕获，1时使能上升沿捕获
                //CAPNn：负捕获，1时使能下降沿捕获
                //MATn:匹配:1时，PCA计数器的值与模块的比较/捕获寄存器的值匹配将置位CCON寄存器中断标志位CCFn
                //T0Gn:翻转，1时，工作在PCA告诉输出模式，PCA计数器的值与模块的比较/捕获寄存器的值匹配将是CEXn脚翻转
                //PWMn:脉宽调节输出模式，1时，使能CEXn脚用做PWM输出
                //EECFn:使能CCFn中断，使能寄存器CCON中的捕获/比较标志CCFn，用来产生中断
// sfr PCA_PWM0=0xF2;//PCA模块0,PWM寄存器
                  //-----------------------------------
                  //         7 6 5 4   3 2   1     0    
                  //PCA_PWMn:- - - - | - - EPCnH EPCnL
                  //-----------------------------------
/***PWM1相关特殊功能寄存器***/
// sfr CCAP1L=0xEB;//PCA模块1的捕捉/比较寄存器高8位
// sfr CCAP1H=0xFB;//PCA模块1的捕捉/比较寄存器高8位
// sfr CCAPM1=0xDB;//PCA模块0的工作模式寄存器
                //---------------------------------------
                //7   6    5     4     3    2    1    0
                //- ECMn CAPPn CAPNn MATn T0Gn PWMn ECCFn
                //----------------------------------------
                //ECOMn:使能比较器，1时使能比较器功能
                //CAPPn：正捕获，1时使能上升沿捕获
                //CAPNn：负捕获，1时使能下降沿捕获
                //MATn:匹配:1时，PCA计数器的值与模块的比较/捕获寄存器的值匹配将置位CCON寄存器中断标志位CCFn
                //T0Gn:翻转，1时，工作在PCA告诉输出模式，PCA计数器的值与模块的比较/捕获寄存器的值匹配将是CEXn脚翻转
                //PWMn:脉宽调节输出模式，1时，使能CEXn脚用做PWM输出
                //EECFn:使能CCFn中断，使能寄存器CCON中的捕获/比较标志CCFn，用来产生中断
// sfr PCA_PWM1=0xF3;//PCA模块0,PWM寄存器
                  //-----------------------------------
                  //         7 6 5 4   3 2   1     0    
                  //PCA_PWMn:- - - - | - - EPCnH EPCnL
                  //-----------------------------------
/***PCA阵列计数控制位***/
// sbit CR=0xDE;//因为只有能和8整除的才能位寻址，所以能些0xDE，看起来有冲突，实际上不会。
/***AUXR1寄存器SFR地址设置***/
//sfr AUXR1=0xA2;//PWM引脚位置 串口2位置 双DPTR选择 AD转换结果存放方式调整 SPI位置调整

/***********函数申明***********/
void PWM_ini();//PWM初始化函数
void PWM_Set(unsigned char ,unsigned char );//PWM占空比设置


#endif